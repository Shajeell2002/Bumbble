<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bumbble - Profile & Friends</title>
<style>
body{font-family:Arial,sans-serif;background:#fff;color:#333;display:flex;flex-direction:column;min-height:100vh;}
header{display:flex;justify-content:space-between;align-items:center;padding:20px;background:#ffcb2b;}
header h1{font-size:24px;}
nav a{margin:0 10px;text-decoration:none;color:#333;font-weight:bold;}
.container{flex:1;padding:20px;max-width:600px;margin:auto;}
.profile-container, .friends-container{background:#f9f9f9;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.profile-container label{display:block;margin-top:10px;font-weight:bold;}
.profile-container input, .profile-container select{width:100%;padding:8px;margin-top:5px;border-radius:5px;border:1px solid #ccc;}
.profile-container button{margin-top:15px;width:100%;padding:10px;background:#ffcb2b;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
.friends-container ul{list-style:none;padding:0;}
.friends-container li{padding:10px;border-bottom:1px solid #ddd;display:flex;justify-content:space-between;align-items:center;}
.status-dot{width:12px;height:12px;border-radius:50%;display:inline-block;margin-left:10px;border:2px solid #fff;}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBkDyP8KPuQc_knXLH9lhtQWDLb59xRJWs",
  authDomain: "bumbble-c061f.firebaseapp.com",
  databaseURL: "https://bumbble-c061f-default-rtdb.firebaseio.com",
  projectId: "bumbble-c061f",
  storageBucket: "bumbble-c061f.appspot.com",
  messagingSenderId: "213165886981",
  appId: "1:213165886981:web:c18652003444869b1bd66c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
</script>
</head>
<body>

<header>
<h1>Bumbble</h1>
<nav id="navLinks"></nav>
</header>

<div class="container">
  <div class="profile-container" id="profileContainer">
    <p>Loading profile...</p>
  </div>

  <div class="friends-container" id="friendsContainer">
    <h3>Friends</h3>
    <ul id="friendsList">
      <li>Loading friends...</li>
    </ul>
  </div>
</div>

<footer>
<p>&copy; 2025 Bumbble. All rights reserved.</p>
</footer>

<script>
const nav = document.getElementById("navLinks");

auth.onAuthStateChanged(user => {
  if(user && user.emailVerified){
    const uid = user.uid;
    localStorage.setItem("current_user", uid);

    // Navigation
    nav.innerHTML = `
      <a href="index.html">Home</a>
      <a href="profile.html">Profile</a>
      <a href="#" id="logoutBtn">Logout</a>
    `;
    document.getElementById("logoutBtn").addEventListener("click", ()=>{
      auth.signOut().then(()=>{
        localStorage.removeItem("current_user");
        window.location.href="login.html";
      });
    });

    // Profile
    const profileContainer = document.getElementById("profileContainer");
    const userRef = db.ref("users/" + uid);

    // Set online status
    const onlineRef = userRef.child("online");
    onlineRef.set(true);
    onlineRef.onDisconnect().set(false);

    userRef.on("value", snapshot => {
      const u = snapshot.val() || {};
      profileContainer.innerHTML = `
        <label>Name</label>
        <input type="text" id="name" value="${u.name || ''}">
        <label>Email (readonly)</label>
        <input type="email" value="${u.email || user.email}" readonly>
        <label>Gender</label>
        <select id="gender">
          <option value="">Select Gender</option>
          <option value="Male" ${u.gender==='Male'?'selected':''}>Male</option>
          <option value="Female" ${u.gender==='Female'?'selected':''}>Female</option>
          <option value="Other" ${u.gender==='Other'?'selected':''}>Other</option>
        </select>
        <label>Location</label>
        <input type="text" id="location" value="${u.location || ''}">
        <label>Age</label>
        <input type="number" id="age" value="${u.age || ''}">
        <button id="saveBtn">Save Profile</button>
      `;

      document.getElementById("saveBtn").addEventListener("click", ()=>{
        const name = document.getElementById("name").value.trim();
        const gender = document.getElementById("gender").value;
        const location = document.getElementById("location").value.trim();
        const age = parseInt(document.getElementById("age").value);

        if(!name || !gender || !location || !age){
          alert("⚠️ Fill all fields");
          return;
        }

        userRef.update({name, gender, location, age})
          .then(()=>alert("✅ Profile saved!"))
          .catch(err=>alert("❌ "+err.message));
      });
    });

    // Friends list
    const friendsList = document.getElementById("friendsList");
    db.ref("users").on("value", snapshot=>{
      friendsList.innerHTML = "";
      snapshot.forEach(child=>{
        const friend = child.val();
        const friendUid = child.key;
        if(friendUid !== uid){ // exclude self
          const li = document.createElement("li");
          li.textContent = friend.name || "Unnamed User";
          const statusDot = document.createElement("span");
          statusDot.className = "status-dot";
          statusDot.style.backgroundColor = friend.online ? "green" : "red";
          li.appendChild(statusDot);
          friendsList.appendChild(li);
        }
      });
    });

  } else {
    nav.innerHTML = `
      <a href="index.html">Home</a>
      <a href="login.html">Login</a>
      <a href="signup.html">Sign Up</a>
    `;
    document.getElementById("profileContainer").innerHTML = "<p>Please login to view profile.</p>";
    document.getElementById("friendsList").innerHTML = "<li>Login to see friends.</li>";
  }
});
</script>

</body>
</html>
