<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bumbble - Notifications</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin:0;
  background: linear-gradient(135deg,#f8f6fb,#e6e0f0);
  color:#333;
}

/* Header */
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 20px;
  background:#d8cce5;
  box-shadow:0 3px 6px rgba(0,0,0,0.1);
  position:fixed;
  top:0;
  left:0;
  right:0;
  z-index:500;
}
header h1 { margin:0; font-size:22px; }
nav a {
  margin-left:12px;
  text-decoration:none;
  font-weight:bold;
  color:#333;
  transition:0.3s;
}
nav a:hover { color:#6a1b9a; }

/* Main */
.container {
  padding:90px 20px 40px 20px;
  max-width:700px;
  margin:auto;
}

h2 {
  margin-bottom:20px;
  font-size:22px;
  border-left:5px solid #9b59b6;
  padding-left:10px;
}

/* === Modern Social Style Notification === */

.request-item {
  display:flex;
  align-items:top-left;
  gap:10px;
  padding:14px 10px;
  border-bottom:1px solid #e0e0e0;
  background:white;
  transition:0.2s ease;
}

.request-item:hover {
  background:#f3eef8;
}

.avatar {
  width:55px;
  height:55px;
  border-radius:50%;
  object-fit:cover;
  background:#ccc;
}

.request-content {
  flex:1;
}

.request-content p {
  margin:0;
  font-size:15px;
}

.actions {
  display:flex;
  gap:8px;
}

.btn-primary {
  padding:6px 14px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  background:#9b59b6;
  color:white;
  transition:0.2s;
}

.btn-primary:hover {
  background:#7e3ea8;
}

.btn-secondary {
  padding:6px 14px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  background:#e4e4e4;
  transition:0.2s;
}

.btn-secondary:hover {
  background:#cccccc;
}

.empty {
  text-align:center;
  color:#777;
  padding:30px;
}
</style>
</head>

<body>

<header>
  <h1>Bumbble</h1>
  <nav id="navLinks"></nav>
</header>

<div class="container">
  <h2>Notification</h2>
  <div id="notificationList"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBkDyP8KPuQc_knXLH9lhtQWDLb59xRJWs",
  authDomain: "bumbble-c061f.firebaseapp.com",
  databaseURL: "https://bumbble-c061f-default-rtdb.firebaseio.com",
  projectId: "bumbble-c061f",
  storageBucket: "bumbble-c061f.appspot.com",
  messagingSenderId: "213165886981",
  appId: "1:213165886981:web:c18652003444869b1bd66c"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const nav = document.getElementById("navLinks");

auth.onAuthStateChanged(user => {

  const container = document.getElementById("notificationList");

  if (!user) {
    nav.innerHTML = '<a href="login.html">Login</a>';
    container.innerHTML = "<div class='empty'>Please login</div>";
    return;
  }

  const uid = user.uid;

  nav.innerHTML = `
    <a href="index.html">Home</a>
    <a href="friends.html">Friends</a>
    <a href="stories.html">Stories</a>
    <a href="profile.html">Profile</a>
    <a href="#" onclick="logout()">Logout</a>
  `;

  db.ref("friendRequests/" + uid).on("value", async snap => {

    container.innerHTML = "";

    if (!snap.exists()) {
      container.innerHTML = "<div class='empty'>No new notifications</div>";
      return;
    }

    for (const senderUid of Object.keys(snap.val())) {

      const userSnap = await db.ref("users/" + senderUid + "/public").once("value");
      const userData = userSnap.val() || {};
      const name = userData.name || "Unknown User";
      const photo = userData.photoURL || "https://via.placeholder.com/55";

      const div = document.createElement("div");
      div.className = "request-item";

      div.innerHTML = `
        <img src="${photo}" class="avatar">

        <div class="request-content">
          <p><strong>${name}</strong> sent you a friend request</p>
        </div>

        <div class="actions">
          <button class="btn-primary" onclick="acceptRequest('${senderUid}')">Confirm</button>
          <button class="btn-secondary" onclick="rejectRequest('${senderUid}')">Delete</button>
        </div>
      `;

      container.appendChild(div);
    }
  });
});

async function acceptRequest(senderUid) {
  const currentUid = firebase.auth().currentUser.uid;

  const updates = {};
  updates["friends/" + currentUid + "/" + senderUid] = true;
  updates["friends/" + senderUid + "/" + currentUid] = true;
  updates["friendRequests/" + currentUid + "/" + senderUid] = null;

  await db.ref().update(updates);
}

async function rejectRequest(senderUid) {
  const currentUid = firebase.auth().currentUser.uid;
  await db.ref("friendRequests/" + currentUid + "/" + senderUid).remove();
}

function logout(){
  auth.signOut().then(()=>window.location.href="login.html");
}
</script>

</body>
</html>
