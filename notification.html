<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bumbble - Notifications</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial; background:#f8f6fb; padding:20px; }
.card { border:1px solid #ccc; padding:10px; margin-bottom:10px; background:white; border-radius:6px; }
button { padding:6px 10px; margin-right:8px; }
</style>
</head>
<body>

<h2>Friend Requests</h2>
<div id="notificationList"></div>
<script>
firebase.auth().onAuthStateChanged(user => {
  console.log("Auth state changed:", user);
});

  const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "bumbble-c061f.firebaseapp.com",
  databaseURL: "https://bumbble-c061f-default-rtdb.firebaseio.com",
  projectId: "bumbble-c061f",
  storageBucket: "bumbble-c061f.appspot.com",
  messagingSenderId: "213165886981",
  appId: "1:213165886981:web:c18652003444869b1bd66c"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

auth.onAuthStateChanged(user => {

  const container = document.getElementById("notificationList");

  if (!user) {
    container.innerHTML = "<p>Please login</p>";
    return;
  }

  console.log("Logged in UID:", user.uid);

  db.ref("friendRequests/" + user.uid).on("value", async snap => {

    console.log("Requests snapshot:", snap.val());

    container.innerHTML = "";

    if (!snap.exists()) {
      container.innerHTML = "<p>No new notifications</p>";
      return;
    }

    for (const senderUid of Object.keys(snap.val())) {

      const userSnap = await db.ref("users/" + senderUid + "/public").once("value");
      console.log("User data:", userSnap.val());

      const name = userSnap.val()?.name || "Unknown User";

      const div = document.createElement("div");
      div.className = "card";

      div.innerHTML = `
        <p>${name} sent you a friend request</p>
        <button onclick="acceptRequest('${senderUid}')">Accept</button>
        <button onclick="rejectRequest('${senderUid}')">Reject</button>
      `;

      container.appendChild(div);
    }
  });
});

async function acceptRequest(senderUid) {
  const currentUid = firebase.auth().currentUser.uid;

  const updates = {};
  updates["friends/" + currentUid + "/" + senderUid] = true;
  updates["friends/" + senderUid + "/" + currentUid] = true;
  updates["friendRequests/" + currentUid + "/" + senderUid] = null;

  await db.ref().update(updates);
}

async function rejectRequest(senderUid) {
  const currentUid = firebase.auth().currentUser.uid;
  await db.ref("friendRequests/" + currentUid + "/" + senderUid).remove();
}
</script>

</body>
</html>
