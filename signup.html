<script>
function signupUser() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const name = document.getElementById("name").value;
  const age = document.getElementById("age").value;
  const location = document.getElementById("location").value;

  auth.createUserWithEmailAndPassword(email, password)
    .then(cred => {
      // Wait for auth state to stabilize
      auth.onAuthStateChanged(user => {
        if (user) {
          const uid = user.uid;

          // Send email verification
          user.sendEmailVerification();

          // Save public profile
          db.ref("users/" + uid + "/public").set({
            name: name,
            age: age,
            location: location,
            pic: "images/profile1.png",
            online: false
          });

          // Save private profile
          db.ref("users/" + uid + "/private").set({
            email: email,
            createdAt: Date.now()
          });

          alert("Signup successful! Please verify your email before logging in.");
          window.location.href = "login.html";
        }
      });
    })
    .catch(err => {
      console.error(err);
      alert("Error: " + err.message);
    });
}
</script>
