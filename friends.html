function loadUsersRealtime(){
  db.ref('users').on('value', snapshot => {
    const usersData = snapshot.val() || {};
    userList.innerHTML = '';
    let firstFriendUid = null;
    let firstFriendName = "";

    Object.keys(usersData).forEach(uid => {
      if(uid === currentUserUid) return;
      const user = usersData[uid].public || {};
      const name = user.name || "Unknown";
      const gender = user.gender || "N/A";

      // Save first friend for auto chat
      if(!firstFriendUid){
        firstFriendUid = uid;
        firstFriendName = name;
      }

      const div = document.createElement('div'); 
      div.classList.add("user-card"); 
      div.dataset.uid = uid;

      let badgeHtml = "";
      if(unreadCounters[uid]) badgeHtml = `<span class="badge">${unreadCounters[uid]}</span>`;

      div.innerHTML = `
        <span><span class="status-dot ${user.online?'online':'offline'}"></span>${name}</span>
        <span>Gender: ${gender}</span>
        <button class="chatBtn">Chat</button>
        ${badgeHtml}
      `;

      div.querySelector(".chatBtn").addEventListener('click', e => {
        e.stopPropagation();
        openChat(uid, name);
      });

      userList.appendChild(div);
    });

    // Open chat with first friend automatically
    if(firstFriendUid){
      openChat(firstFriendUid, firstFriendName);
    }
  });
}
