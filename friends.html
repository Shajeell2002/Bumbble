<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bumbble - Friends</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Arial,sans-serif;background:#fff;color:#333;min-height:100vh;display:flex;flex-direction:column;}
header{display:flex;justify-content:space-between;align-items:center;padding:20px;background:#ffcb2b;}
header h1{font-size:24px;}
nav a{margin:0 10px;text-decoration:none;color:#333;font-weight:bold;}
nav a:hover{text-decoration: underline;}
.section{flex:1;padding:40px 20px;}
.section h2{text-align:center;margin-bottom:20px;}
.friend-container{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;}
.friend-card{background:#f9f9f9;border-radius:15px;padding:20px;width:200px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,0.1);position:relative;}
.friend-card h3{margin-bottom:5px;}
.friend-card p{color:#555;margin:2px 0;font-size:14px;}
.status-dot{width:15px;height:15px;border-radius:50%;position:absolute;top:10px;right:10px;border:2px solid #fff;}
footer{text-align:center;padding:20px;background:#f1f1f1;margin-top:40px;}
@media(max-width:768px){.friend-card{width:90%;}}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBkDyP8KPuQc_knXLH9lhtQWDLb59xRJWs",
  authDomain: "bumbble-c061f.firebaseapp.com",
  databaseURL: "https://bumbble-c061f-default-rtdb.firebaseio.com",
  projectId: "bumbble-c061f",
  storageBucket: "bumbble-c061f.appspot.com",
  messagingSenderId: "213165886981",
  appId: "1:213165886981:web:c18652003444869b1bd66c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
</script>
</head>

<body>
<header>
<h1>Bumbble</h1>
<nav id="navLinks"></nav>
</header>

<section class="section">
<h2>Friends</h2>
<div class="friend-container" id="friendContainer">
<p>Loading friends...</p>
</div>
</section>

<footer>
<p>&copy; 2025 Bumbble. All rights reserved.</p>
</footer>

<script>
// Dynamic header
const nav = document.getElementById("navLinks");
auth.onAuthStateChanged(user => {
  if(user && user.emailVerified){
    localStorage.setItem("current_user", user.uid);
    nav.innerHTML = `
      <a href="index.html">Home</a>
      <a href="friends.html">Friends</a>
      <a href="stories.html">Stories</a>
      <a href="events.html">Events</a>
      <a href="safety.html">Safety</a>
      <a href="profile.html">Profile</a>
      <a href="#" id="logoutBtn">Logout</a>
    `;
    document.getElementById("logoutBtn").addEventListener("click", ()=>{
      auth.signOut().then(()=>{
        localStorage.removeItem("current_user");
        window.location.href="login.html";
      });
    });

    const friendContainer = document.getElementById("friendContainer");

    // Set current user online and auto offline on disconnect
    const currentUserRef = db.ref("users/" + user.uid);
    currentUserRef.child("online").set(true);
    currentUserRef.child("online").onDisconnect().set(false);

    // Real-time friends list
    db.ref("users").on("value", snapshot => {
      let html = "";
      snapshot.forEach(child => {
        const u = child.val();
        const name = u.name || "Unnamed";
        const gender = u.gender || "Not set";
        const location = u.location || "Unknown";
        const online = u.online ? true : false;

        html += `
          <div class="friend-card">
            <h3>${name}</h3>
            <p>Gender: ${gender}</p>
            <p>Location: ${location}</p>
            <span class="status-dot" style="background-color:${online?'green':'red'}"></span>
          </div>
        `;
      });
      friendContainer.innerHTML = html || "<p>No friends found.</p>";
    });

  } else {
    nav.innerHTML = `
      <a href="index.html">Home</a>
      <a href="friends.html">Friends</a>
      <a href="stories.html">Stories</a>
      <a href="events.html">Events</a>
      <a href="safety.html">Safety</a>
      <a href="login.html">Login</a>
      <a href="signup.html">Sign Up</a>
    `;
    friendContainer.innerHTML = "<p>Please login to view friends.</p>";
  }
});
</script>
</body>
</html>
