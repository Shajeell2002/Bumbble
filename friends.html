<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bumbble - Sign Up</title>
<style>
body{font-family:Arial,sans-serif;background:#fff;color:#333;display:flex;flex-direction:column;align-items:center;min-height:100vh;margin:0;padding:0;}
h1{margin-top:40px;color:#ffcb2b;}
form{display:flex;flex-direction:column;width:300px;margin-top:20px;}
input,button{margin:8px 0;padding:10px;border-radius:6px;border:1px solid #ccc;font-size:14px;}
button{background:#ffcb2b;color:#333;font-weight:bold;border:none;cursor:pointer;}
#otpContainer{display:none;}
#message{color:red;font-size:14px;margin-top:5px;}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<h1>Bumbble - Sign Up</h1>

<form id="signupForm">
  <input type="text" id="name" placeholder="Full Name" required>
  <input type="number" id="age" placeholder="Age" required>
  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <input type="text" id="phone" placeholder="Mobile Number (+CountryCode)" required>
  <button type="submit">Sign Up</button>
</form>

<div id="otpContainer">
  <h3>Enter OTP sent to your mobile</h3>
  <input type="text" id="otpInput" placeholder="OTP">
  <button id="verifyOtpBtn">Verify OTP</button>
</div>

<div id="message"></div>

<div id="recaptcha-container"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBkDyP8KPuQc_knXLH9lhtQWDLb59xRJWs",
  authDomain: "bumbble-c061f.firebaseapp.com",
  databaseURL: "https://bumbble-c061f-default-rtdb.firebaseio.com",
  projectId: "bumbble-c061f",
  storageBucket: "bumbble-c061f.appspot.com",
  messagingSenderId: "213165886981",
  appId: "1:213165886981:web:c18652003444869b1bd66c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// Setup reCAPTCHA
const recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
  'size': 'invisible'
});

document.getElementById("signupForm").addEventListener("submit", e=>{
  e.preventDefault();
  const name=document.getElementById("name").value.trim();
  const age=document.getElementById("age").value.trim();
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  const phone=document.getElementById("phone").value.trim();
  const messageDiv=document.getElementById("message");

  messageDiv.textContent="";

  // Create user with email/password
  auth.createUserWithEmailAndPassword(email,password).then(userCredential=>{
    const user=userCredential.user;

    // Send email verification
    user.sendEmailVerification().then(()=>{
      alert("Email verification sent. Please check your inbox.");

      // Save minimal public info
      db.ref("users/"+user.uid+"/userPublic").set({
        name, age, pic:"default.png", online:false
      });

      // Phone verification
      const appVerifier = recaptchaVerifier;
      auth.signInWithPhoneNumber(phone, appVerifier).then(confirmationResult=>{
        window.confirmationResult = confirmationResult;
        document.getElementById("otpContainer").style.display="block";
      }).catch(err=>{
        console.error(err);
        messageDiv.textContent="Error sending OTP: "+err.message;
      });
    }).catch(err=>{
      console.error(err);
      messageDiv.textContent="Error sending email verification: "+err.message;
    });

  }).catch(err=>{
    console.error(err);
    messageDiv.textContent="Signup failed: "+err.message;
  });
});

// OTP verification
document.getElementById("verifyOtpBtn").addEventListener("click", ()=>{
  const code=document.getElementById("otpInput").value.trim();
  const messageDiv=document.getElementById("message");
  messageDiv.textContent="";

  if(!code){
    messageDiv.textContent="Please enter OTP.";
    return;
  }

  window.confirmationResult.confirm(code).then(result=>{
    alert("Mobile verified successfully! You can now login.");
    window.location.href="login.html";
  }).catch(err=>{
    console.error(err);
    messageDiv.textContent="Invalid OTP: "+err.message;
  });
});
</script>
</body>
</html>
