<script>
// NAVIGATION MENU
const nav = document.getElementById("navLinks");
const currentUser = localStorage.getItem("current_user");

if(currentUser){
    const currentUserData = JSON.parse(localStorage.getItem("user_" + currentUser)) || {};
    nav.innerHTML = `
        <a href="index.html">Home</a>
        <a href="date.html">Date</a>
        <a href="friends.html">Friends</a>
        <a href="stories.html">Stories</a>
        <a href="events.html">Events</a>
        <a href="safety.html">Safety</a>
        <a href="profile.html">Profile</a>
        <a href="#" id="logoutBtn">Logout</a>
    `;

    document.getElementById("logoutBtn").addEventListener("click", function(){
        localStorage.removeItem("current_user");
        alert("âœ… Logged out successfully.");
        window.location.href = "login.html";
    });
} else {
    nav.innerHTML = `
        <a href="index.html">Home</a>
        <a href="date.html">Date</a>
        <a href="friends.html">Friends</a>
        <a href="stories.html">Stories</a>
        <a href="events.html">Events</a>
        <a href="safety.html">Safety</a>
        <a href="login.html">Login</a>
        <a href="signup.html">Sign Up</a>
    `;
}

// FRIEND LIST LOGIC
const friendContainer = document.getElementById("friendContainer");
const noFriendsMsg = document.getElementById("noFriendsMsg");
let friendsFound = false;

// Current time in ms
const now = new Date().getTime();

// Consider "online" if lastLogin within last 15 min
const ONLINE_THRESHOLD = 15*60*1000; // 15 minutes in ms

for(let i=0; i<localStorage.length; i++){
    const key = localStorage.key(i);
    if(key.startsWith("user_")){
        const user = JSON.parse(localStorage.getItem(key));

        const lastLogin = user.lastLogin || 0;
        const online = (now - lastLogin) <= ONLINE_THRESHOLD;

        const imgSrc = user.pic || "images/profile1.png";
        const card = document.createElement("div");
        card.classList.add("friend-card");
        card.innerHTML = `
            <img src="${imgSrc}" alt="Profile Picture">
            <h3>${user.name}${user.email === currentUser ? " (You)" : ""}</h3>
            <p><strong>Gender:</strong> ${user.gender || "Unknown"}</p>
            <p><strong>Location:</strong> ${user.location || "Unknown"}</p>
            <span class="status-dot" style="background-color:${online?'green':'red'}"></span>
        `;
        friendContainer.appendChild(card);
        friendsFound = true;
    }
}

if(!friendsFound){
    noFriendsMsg.style.display = "block";
}
</script>
