<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bumbble - Friends & Chat</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  margin:0; 
  background:#fefefe; 
  color:#333; 
  display:flex; 
  min-height:100vh; 
}

/* Sidebar */
.friends-container {
  width:250px; 
  background:#fffbe6;
  border-right:1px solid #eee;
  padding:10px;
  overflow-y:auto;
  position:fixed;
  top:0;
  bottom:0;
  left:0;
  transition:transform 0.3s ease;
  z-index:1000;
}
.friends-container.hide {
  transform:translateX(-100%);
}

/* Sidebar toggle for mobile */
#sidebarToggle {
  position:fixed;
  top:15px;
  left:15px;
  background:#ffcb05;
  border:none;
  padding:8px 12px;
  border-radius:6px;
  cursor:pointer;
  z-index:1100;
}

/* Main content */
.main-content {
  flex:1;
  margin-left:250px;
  padding:20px;
  transition:margin-left 0.3s ease;
}
.main-content.full {
  margin-left:0;
}

/* User list */
.user-list {
  display:flex;
  flex-direction:column;
  gap:2px;
  font-size:14px;
}
.user-row { 
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  padding:8px; 
  border-bottom:1px solid #eee; 
  cursor:pointer; 
  transition:background 0.2s;
}
.user-row:hover { background:#fff6b3; }
.status-dot {
  width:8px; height:8px; border-radius:50%; display:inline-block; margin-right:6px;
}
.status-dot.online { background:#2ecc71; }
.status-dot.offline { background:#ccc; }
.badge {
  background:#ff3b30; color:#fff; padding:1px 5px; font-size:11px; border-radius:8px;
  margin-left:4px;
}

/* Chat modal */
#chatModal {
  position:fixed;
  bottom:0;
  right:20px;
  width:300px;
  max-height:400px;
  border:1px solid #ccc;
  background:#fff;
  border-radius:10px 10px 0 0;
  display:none;
  flex-direction:column;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
  resize:both;
  overflow:hidden;
  z-index:2000;
}
.chat-header {
  background:#ffcb05; padding:10px; font-weight:bold; cursor:move;
}
.chat-messages {
  flex:1; overflow-y:auto; padding:10px; font-size:13px;
}
.chat-input {
  display:flex; border-top:1px solid #ddd;
}
.chat-input input {
  flex:1; border:none; padding:8px;
}
.chat-input button {
  background:#ffcb05; border:none; padding:8px 10px; cursor:pointer;
}
</style>
</head>
<body>

<button id="sidebarToggle">â˜°</button>

<div class="friends-container" id="sidebar">
  <h3 style="margin-top:0;">Friends</h3>
  <div class="user-list" id="userList"></div>
</div>

<div class="main-content" id="mainContent">
  <h1>Welcome to Bumbble Chat</h1>
  <p>Click on any user name to start chatting.</p>
</div>

<!-- Chat modal -->
<div id="chatModal">
  <div class="chat-header" id="chatHeader"></div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="chat-input">
    <input type="text" id="chatInput" placeholder="Type a message..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script type="module">
// Firebase setup
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

const firebaseConfig = { 
  apiKey:"AIzaSyBkDyP8KPuQc_knXLH9lhtQWDLb59xRJWs", 
  authDomain:"bumbble-c061f.firebaseapp.com", 
  databaseURL:"https://bumbble-c061f-default-rtdb.firebaseio.com", 
  projectId:"bumbble-c061f", 
  storageBucket:"bumbble-c061f.appspot.com", 
  messagingSenderId:"327821837105", 
  appId:"1:327821837105:web:cc3727d91c0e85d7ecbdb1"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Elements
const userList = document.getElementById("userList");
const chatModal = document.getElementById("chatModal");
const chatHeader = document.getElementById("chatHeader");
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
const sendBtn = document.getElementById("sendBtn");

let currentUser = { uid: "demoUser123", name: "You" };
let activeChatUid = null;

// Load users realtime
function loadUsersRealtime() {
  const usersRef = ref(db, "users");
  onValue(usersRef, (snapshot) => {
    userList.innerHTML = "";
    const users = [];
    snapshot.forEach((child) => {
      const user = child.val();
      if (child.key !== currentUser.uid) {
        users.push({ uid: child.key, ...user });
      }
    });

    users.sort((a,b) => (b.online === true) - (a.online === true));

    users.forEach(user => {
      const name = user.name || "User";
      const gender = user.gender || "";
      const badgeHtml = user.unread ? `<span class='badge'>${user.unread}</span>` : "";
      const row = document.createElement("div");
      row.className = "user-row";
      row.innerHTML = `
        <div class="user-name">
          <span class="status-dot ${user.online?'online':'offline'}"></span>
          ${name} (${gender}) ${badgeHtml}
        </div>
      `;
      row.addEventListener('click', () => {
        openChat(user.uid, name);
      });
      userList.appendChild(row);
    });
  });
}
loadUsersRealtime();

// Open chat
function openChat(uid, name) {
  activeChatUid = uid;
  chatHeader.textContent = "Chat with " + name;
  chatModal.style.display = "flex";
  loadChatMessages(uid);
}

// Load messages realtime
function loadChatMessages(uid) {
  const msgRef = ref(db, `messages/${uid}`);
  onValue(msgRef, (snapshot) => {
    chatMessages.innerHTML = "";
    snapshot.forEach((child) => {
      const msg = child.val();
      const div = document.createElement("div");
      div.textContent = `${msg.sender}: ${msg.text}`;
      chatMessages.appendChild(div);
    });
    chatMessages.scrollTop = chatMessages.scrollHeight;
  });
}

// Send message
sendBtn.addEventListener("click", () => {
  const text = chatInput.value.trim();
  if (!text || !activeChatUid) return;
  const msgRef = push(ref(db, `messages/${activeChatUid}`));
  set(msgRef, { sender: currentUser.name, text, timestamp: Date.now() });
  chatInput.value = "";
});
</script>

<script>
// --- Sidebar toggle ---
const sidebar = document.getElementById('sidebar');
const mainContent = document.getElementById('mainContent');
const sidebarToggle = document.getElementById('sidebarToggle');

function toggleSidebar() {
  sidebar.classList.toggle('hide');
  mainContent.classList.toggle('full');
}
sidebarToggle.addEventListener('click', toggleSidebar);

// --- Swipe gestures ---
let touchStartX = 0;
let touchEndX = 0;
document.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
document.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleGesture(); }, {passive: true});
function handleGesture() {
  if (touchEndX - touchStartX > 50) { // swipe right
    sidebar.classList.remove('hide');
    mainContent.classList.remove('full');
  } else if (touchStartX - touchEndX > 50) { // swipe left
    sidebar.classList.add('hide');
    mainContent.classList.add('full');
  }
}
</script>

</body>
</html>
